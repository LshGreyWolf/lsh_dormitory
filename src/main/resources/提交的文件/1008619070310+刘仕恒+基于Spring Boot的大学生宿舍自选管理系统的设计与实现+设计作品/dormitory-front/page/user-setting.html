<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>个人中心</title>

    <style>
        /* 用户信息 */
        .user-info-head {
            width: 110px;
            height: 110px;
            line-height: 110px;
            position: relative;
            display: inline-block;
            border: 2px solid #eee;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            margin: 0 auto;
        }

        .user-info-head:hover:after {
            content: '\e681';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            color: #fff;
            background-color: rgba(0, 0, 0, 0.3);
            font-size: 28px;
            padding-top: 2px;
            font-style: normal;
            font-family: layui-icon;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .user-info-head img {
            width: 110px;
            height: 110px;
        }

        .user-info-list-item {
            position: relative;
            padding-bottom: 8px;
        }

        .user-info-list-item > .layui-icon {
            position: absolute;
        }

        .user-info-list-item > p {
            padding-left: 30px;
        }

        .layui-line-dash {
            border-bottom: 1px dashed #ccc;
            margin: 15px 0;
        }

        /* 基本信息 */
        #userInfoForm .layui-form-item {
            margin-bottom: 25px;
        }

        /* 账号绑定 */
        .user-bd-list-item {
            padding: 14px 60px 14px 10px;
            border-bottom: 1px solid #e8e8e8;
            position: relative;
        }

        .user-bd-list-item .user-bd-list-lable {
            color: #333;
            margin-bottom: 4px;
        }

        .user-bd-list-item .user-bd-list-oper {
            position: absolute;
            top: 50%;
            right: 10px;
            margin-top: -8px;
            cursor: pointer;
        }

        .user-bd-list-item .user-bd-list-img {
            width: 48px;
            height: 48px;
            line-height: 48px;
            position: absolute;
            top: 50%;
            left: 10px;
            margin-top: -24px;
        }

        .user-bd-list-item .user-bd-list-img + .user-bd-list-content {
            margin-left: 68px;
        }
    </style>
</head>
<body>
<!-- 正文开始 -->
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-sm12 layui-col-md3">
            <div class="layui-card" style="height: 600px">
                <div class="layui-card-body" style="padding: 25px;margin-top: 15px">
                    <div class="text-center layui-text">
                        <div class="user-info-head" id="userInfoHead">

                        </div>
                        <h2 style="padding-top: 20px;"></h2>
                        <p style="padding-top: 8px;">人生就像是一场修行</p>
                    </div>

                    <div class="layui-text" style="padding-top: 200px;">
                        <div class="user-info-list-item">
                            <i class="layui-icon layui-icon-username"></i>
                            <p id="type"></p>
                        </div>
                        <div class="user-info-list-item">
                            <i class="layui-icon layui-icon-release"></i>
                            <p>河北水利电力学院-宿舍部</p>
                        </div>
                        <div class="user-info-list-item">
                            <i class="layui-icon layui-icon-location"></i>
                            <p>河北省沧州市</p>
                        </div>
                    </div>
                    <div class="layui-line-dash"></div>

                </div>
            </div>
        </div>

        <!-- 右 -->
        <div class="layui-col-sm12 layui-col-md9">
            <div class="layui-card" style="height: 600px">
                <!-- 选项卡开始 -->
                <div class="layui-tab layui-tab-brief" lay-filter="userInfoTab" style="margin-top: 15px">
                    <ul class="layui-tab-title">
                        <li class="layui-this">基本资料</li>
                    </ul>
                    <div class="layui-tab-content">
                        <!-- tab1 -->
                        <div class="layui-tab-item layui-show">
                            <form class="layui-form" id="userInfoForm" lay-filter="userInfoForm"
                                  style="max-width: 400px;padding: 25px 10px 0 0;">
                                <div class="layui-form-item">
                                    <label class="layui-form-label layui-form-required">我的角色:</label>
                                    <div class="layui-input-block">

                                        <input name="name" class="layui-input" id="type1"
                                               lay-verify="required" readonly/>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label layui-form-required">姓名:</label>
                                    <div class="layui-input-block">

                                        <input name="name" class="layui-input" id="name"
                                               lay-verify="required" required/>

                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label layui-form-required">用户名:</label>
                                    <div class="layui-input-block">
                                        <input name="userName" class="layui-input" id="username"
                                               lay-verify="required" required/>
                                        <p style="color: #9F9F9F;margin-left: 5px;margin-top: 3px">一般用于后台登入名</p>
                                    </div>
                                </div>
                                <div class="layui-form-item ">
                                    <label class="layui-form-label">联系电话:</label>
                                    <div class="layui-input-block ">
                                        <input name="phone" id="phone" class="layui-input"/>
                                        <p style="color: #9F9F9F;margin-left: 5px;margin-top: 3px"> 请确保联系电话正确</p>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">备注:</label>
                                    <div class="layui-input-block">
                                        <textarea name="remark" id="remark" placeholder="备注"
                                                  class="layui-textarea"></textarea>
                                    </div>
                                </div>

                                <div class="layui-form-item">
                                    <div class="layui-input-block">
                                        <button class="layui-btn" lay-filter="userInfoSubmit" lay-submit>更新基本资料
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>
                <!-- //选项卡结束 -->
            </div>
        </div>
    </div>
</div>
<div class="layui-fluid" id="studentId" style="display: none">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-sm12 layui-col-md3">
            <div class="layui-card" style="height: 600px">
                <div class="layui-card-body" style="padding: 25px;margin-top: 15px">
                    <div class="text-center layui-text">
                        <div class="user-info-head" id="studentInfoHead">

                        </div>
                        <h2 style="padding-top: 20px;"></h2>
                        <p style="padding-top: 8px;">路本是无所谓有和无的，走的人多了，就没路了。。</p>
                    </div>

                    <div class="layui-text" style="padding-top:300px;">
                        <div class="user-info-list-item">
                            <i class="layui-icon layui-icon-username"></i>
                            <p id="stuName"></p>
                        </div>
                        <div class="user-info-list-item">
                            <i class="layui-icon layui-icon-release"></i>
                            <p>河北水利电力学院</p>
                        </div>
                        <div class="user-info-list-item">
                            <i class="layui-icon layui-icon-location"></i>
                            <p>河北省沧州市</p>
                        </div>
                    </div>
                    <div class="layui-line-dash"></div>

                </div>
            </div>
        </div>

        <!-- 右 -->
        <div class="layui-col-sm12 layui-col-md9">
            <div class="layui-card" style="height: 600px">
                <!-- 选项卡开始 -->
                <div class="layui-tab layui-tab-brief" lay-filter="userInfoTab" style="margin-top: 15px">
                    <ul class="layui-tab-title">
                        <li class="layui-this">基本资料</li>
                    </ul>
                    <div class="layui-tab-content">
                        <!-- tab1 -->
                        <div class="layui-tab-item layui-show">
                            <form class="layui-form" lay-filter="userInfoForm"
                                  style="max-width: 400px;padding: 25px 10px 0 0;">
                                <div class="layui-form-item">
                                    <label class="layui-form-label layui-form-required">姓名:</label>
                                    <div class="layui-input-block">

                                        <input name="name" class="layui-input" id="studentName"
                                               lay-verify="required" readonly/>
                                        <p style="color: #9F9F9F;margin-left: 5px;margin-top: 3px">
                                            该信息不可修改，若要修改请联系管理员</p>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label layui-form-required">年级:</label>
                                    <div class="layui-input-block">
                                        <input name="userName" class="layui-input" id="gradeId"
                                               lay-verify="required" readonly/>
                                        <p style="color: #9F9F9F;margin-left: 5px;margin-top: 3px">
                                            该信息不可修改，若要修改请联系管理员</p>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label layui-form-required">班级:</label>
                                    <div class="layui-input-block">
                                        <input name="userName" class="layui-input" id="clazzId"
                                               lay-verify="required" readonly/>
                                        <p style="color: #9F9F9F;margin-left: 5px;margin-top: 3px">
                                            该信息不可修改，若要修改请联系管理员</p>
                                    </div>
                                </div>
                                <div class="layui-form-item ">
                                    <label class="layui-form-label">学号:</label>
                                    <div class="layui-input-block ">
                                        <input name="phone" class="layui-input" id="stuNo" readonly/>
                                        <p style="color: #9F9F9F;margin-left: 5px;margin-top: 3px">
                                            该信息不可修改，若要修改请联系管理员</p>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">身份证号:</label>
                                    <div class="layui-input-block">
                                        <input name="idcard" class="layui-input" id="idCard"/>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">手机号:</label>
                                    <div class="layui-input-block">
                                        <input name="phone" class="layui-input" id="studentPhone"/>
                                    </div>
                                </div>

                                <div class="layui-form-item">
                                    <div class="layui-input-block">
                                        <button class="layui-btn" lay-filter="studentInfoSubmit" lay-submit>更新基本资料
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>
                <!-- //选项卡结束 -->
            </div>
        </div>
    </div>
</div>

<script>
    layui.use(['layer', 'form', 'element', 'upload', 'miniAdmin', 'axios'], function () {
        var $ = layui.jquery,
            layer = layui.layer,
            form = layui.form,
            axios = layui.axios,
            miniAdmin = layui.miniAdmin,
            upload = layui.upload,
            element = layui.element;


        let type = store.getLoginType()
        if (type == 1) {
            $(".layui-fluid").hide()
            $("#studentId").show()
            axios.post('/user/img').then(function (res) {
                $('#studentInfoHead').append('<img id="currentHeaderImgBox" src="' + res.msg + '" />');
            })
        }


        upload.render({
            elem: '#userInfoHead'
            , accept: 'images'
            , acceptMime: 'image/*'
            , url: 'http://localhost:8888/dormitory/user/upload'
            , data: {type: type}
            , before: function (obj) {
                layer.load();
            }
            , done: function (res, index, upload) {

                miniAdmin.success("上传成功！")
                layer.closeAll('loading');

                $('#userInfoHead').append('<img id="currentHeaderImgBox" src="' + res.msg + '" />');

            }
            , error: function () {
                layer.closeAll('loading');
            }
        });

        upload.render({
            elem: '#studentInfoHead'
            , accept: 'images'
            , acceptMime: 'image/*'
            , url: 'http://localhost:8888/dormitory/user/upload'
            , data: {type: type}
            , before: function (obj) {
                layer.load();
            }
            , done: function (res, index, upload) {

                miniAdmin.success("上传成功！")
                layer.closeAll('loading');

                $('#studentInfoHead').append('<img id="currentHeaderImgBox" src="' + res.msg + '" />');

            }
            , error: function () {
                layer.closeAll('loading');
            }
        });
        if (type == 0) {
            //回显用户信息
            axios.get('user/getUser').then(function (res) {
                if (res.code == 200) {
                    let data = res.data
                    $("#name").val(data.name)
                    $("#username").val(data.userName)
                    $("#phone").val(data.phone)
                    $("#remark").val(data.remark)
                    if (data.type == 0) {
                        $("#type").append("超级管理员")
                    } else {
                        $("#type").append("宿管员")
                    }
                    if (data.type == 0) {
                        $("#type1").val("超级管理员")
                    } else {
                        $("#type1").val("宿管员")
                    }
                }
            })

            axios.post('/user/img').then(function (res) {
                $('#userInfoHead').append('<img id="currentHeaderImgBox" src="' + res.msg + '" />');
            })
        }

        //回显学生信息
        function selectStudent() {
            axios.post('stu/info', {}).then(function (response) {
                $('#stuNo').val(response.data.stuNo);
                $('#studentName').val(response.data.name);
                $('#idCard').val(response.data.idcard);
                $('#gradeId').val(response.data.grade.name);
                $('#clazzId').val(response.data.org.name);
                $('#studentPhone').val(response.data.phone);
                $('#stuName').append(response.data.name);
            })
        }

        selectStudent()
        //修改用户信息
        form.on('submit(userInfoSubmit)', function (data) {
            // layer.msg(JSON.stringify(data.field));
            console.log(data.field)
            axios.post('user/updateUserInformation', data.field).then(function (res) {
                if (res.code == 200) {
                    miniAdmin.success(res.msg)
                }
            })
            return false;
        });

        //修改学生信息
        form.on('submit(studentInfoSubmit)', function (data) {
            console.log(data.field)
            axios.post('stu/updateStudent', data.field).then(function (res) {
                if (res.code == 200) {
                    miniAdmin.success(res.msg)
                }
            })
            return false;
        });

    })
    ;
</script>
</body>
</html>
