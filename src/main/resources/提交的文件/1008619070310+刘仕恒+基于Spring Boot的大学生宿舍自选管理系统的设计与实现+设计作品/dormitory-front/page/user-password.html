<!-- 修改密码表单 -->
<div class="layuimini-main">

    <form class="layui-form model-form">
        <div class="layui-form-item">
            <label style="margin-left:300px" class="layui-form-label layui-form-required">原始密码:</label>
            <div class="layui-input-block">
                <input style="width: 300px" type="password" name="password" placeholder="请输入原始密码" class="layui-input"
                       lay-verify="required" required/>
            </div>
        </div>
        <div class="layui-form-item">
            <label style="margin-left: 300px" class="layui-form-label layui-form-required">新密码:</label>
            <div class="layui-input-block">
                <input style="width: 300px" type="password" name="newPassword" placeholder="请输入新密码" class="layui-input"
                       lay-verify="required|psw" required/>
            </div>
        </div>
        <div class="layui-form-item">
            <label style="margin-left: 300px" class="layui-form-label layui-form-required">确认密码:</label>
            <div class="layui-input-block">
                <input style="width: 300px" type="password" name="reNewPassword" placeholder="请再次输入新密码"
                       class="layui-input"
                       lay-verify="required|equalTo" lay-equalTo="input[name=newPassword]" required/>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block " style="margin-left: 450px">
                <button class="layui-btn layui-btn-normal" lay-filter="submit-psw" lay-submit>保存</button>
                <button class="layui-btn layui-btn-primary" type="button" ew-event="closeDialog">取消</button>
            </div>
        </div>
    </form>
</div>
<!-- js部分 -->
<script>
    layui.use(['layer', 'form', 'axios','store','miniAdmin'], function () {
        var $ = layui.jquery,
            layer = layui.layer,
            miniAdmin = layui.miniAdmin,
            store = layui.store,
            axios = layui.axios,
            form = layui.form;

        // 监听提交
        form.on('submit(submit-psw)', function (data) {
            let param = {}
            param.type=store.getLoginType()
            param.password = data.field.password
            param.newPassword = data.field.newPassword
            param.reNewPassword = data.field.reNewPassword
            axios.post('user/modifyPassword',param).then(function (res){
                    if (res.code == 200){
                        miniAdmin.success(res.msg)
                        setTimeout(function (){
                            layer.alert('您的登录信息已过期，请重新登录。', function (index) {
                                location.href="login.html"
                                layer.close(index);
                            });
                        },1000)

                    }

            }).catch(function (error){
                miniAdmin.error(error)
            })


            return false;
        });

    });
</script>
